<!DOCTYPE html>
<html lang=en>
    <head>
        <meta charset=UTF-8>
        <title>Elijah's M3U8 Video Player</title>
        <link rel=icon type=image/x-icon href=https://i.ibb.co/F83q2Hh/m3u8.png>
        <meta name=viewport content="width=device-width, initial-scale=1.0">
        <link href=https://cdnjs.cloudflare.com/ajax/libs/video.js/5.10.2/alt/video-js-cdn.css rel=stylesheet>
<style>

body {
    margin: 0;
    padding: 0;
    background-color: #1a1a1a;
    color: #fff;
    font-family: Arial,sans-serif;
    }

#btn-play.disabled {
    background-color: gray;
    cursor: not-allowed;
    }
#btn-play:hover.disabled {
    background-color: gray;
    cursor: not-allowed;
    }
    
#btn-play.disabled:hover::after {
    content: "Reload to play another video.";
    display: block;
    color: white;
    font-size: 12px;
    margin-top: 5px;
    text-align: center;
    }

#url {
    flex: 1;
    padding: 10px;
    border: 0;
    background-color: #292929;
    color: #fff;
    border-radius: 4px;

    }

.container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px
    }

.input-container {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    }

.popinput {
    flex: 1;
    padding: 5px;
    margin: 15px;
    border: 1px;
    background-color: #292929;
    color: #fff;
    border-radius: 4px;
    }


.genbut {
    background-color: #f76c6c;
    border: 0;
    color: #fff;
    padding: 10px 20px;
    cursor: pointer;
    transition:background-color .3s ease;
    margin-bottom: 10px;
    border-radius: 4px;

    }

#btn-play,#btn-copy,#genbut {
    background-color: #f76c6c;
    border: 0;
    margin-left: 4px;
    color: #fff;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
    transition:background-color .3s ease;
    }

#btn-play:hover,#btn-copy:hover,#genbut:hover {
    background-color: #d64848;
    }
    
#video {
    width: 100%;
    height: 400px;
    display: none;
    border-top-left-radius: 6px;
    border-top-right-radius: 6px; 
    }
    
.popup-container {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    justify-content: center;
    align-items: center;
    z-index: 9999;
    }
    
.popup {
    position: relative;
    background-color: #1a1a1a;
    padding: 20px;
    max-width: 400px;
    width: 90%;
    border-radius: 5px;
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
    }

.video-container {
    border-radius: 4px;
    }
    
.close-btn {
    position: absolute;
    top: 5px;
    right: 9px;
    font-size: 18px;
    cursor: pointer;
    }
    

</style>
<script src=https://cdnjs.cloudflare.com/ajax/libs/video.js/5.10.2/video.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/videojs-contrib-hls/3.0.2/videojs-contrib-hls.js></script>
</head>
<body>
    <div class=container>
        <h1>Elijah's M3U8 Video Player</h1>
        <div class=input-container>
            <input type=text id=url placeholder="Enter M3U8 URL">
            <input type=button id=btn-play value=Play>
            <input type=button id=btn-copy value=FFmpeg>
        </div>
        <video id=video class="video-js vjs-default-skin" preload=none crossorigin=true controls autoplay>
        
        </video>
        <div class=popup-container id=popupContainer>
            <div class=popup>
                <span class=close-btn id=closePopup>&times;</span>
                <label for=filename>File Name:&nbsp&nbsp&nbsp&nbsp</label>
                <input class=popinput type=text id=filename placeholder="Default is output.mp4">
                <br>
                <label for=location>File Location:</label>
                <input class=popinput type=text id=location placeholder="Leave blank for current directory">
                <button class=genbut id=generateFFmpeg>Copy FFmpeg Command</button>
                <div style=max-width:100%;overflow-wrap:break-word;word-break:break-all id=ffmpegCommandOutput>
                </div>
            </div>
        </div>
    </div>
<script>
$(document).ready(function() {
  $("#url").on("keyup", function(event) {
    if (event.key === "Enter") {
      const newUrl = $("#url").val();
      loadVideo(newUrl);
      updateURLParams(newUrl);
      $("#url").blur();
      $("#btn-play").addClass("disabled");
      $("#btn-play").addClass("disabled");
    }
  });

  $("#btn-play").on("click", function() {
    const newUrl = $("#url").val();
    if (!$(this).hasClass("disabled")) {
      loadVideo(newUrl);
      updateURLParams(newUrl);
      $("#url").blur();
      $(this).addClass("disabled");
    }
  });

  $("#btn-copy").on("click", function() {
    $("#popupContainer").css("display", "flex");
    $("#url").blur();
  });

  $("#popupContainer").on("click", function(event) {
    if (event.target === this) {
      closePopup();
    }
  });

  $("#closePopup").on("click", function() {
    closePopup();
  });

  $(document).on("keydown", function(e) {
    if (e.key === "Escape") {
      closePopup();
    }
  });

  $("#filename, #location").on("input", function() {
    updateFFmpegCommandOutput();
  });

  $("#generateFFmpeg").on("click", function() {
    const url = $("#url").val();
    const filename = $("#filename").val();
    const location = $("#location").val();
    const outputFilename = filename ? filename + ".mp4" : "output.mp4";
    const outputLocation = location ? location + "/" + outputFilename : outputFilename;

    const userAgent =
      "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36";

    const ffmpegCommand = `ffmpeg -user_agent "${userAgent}" -i "${url}" -c copy -bsf:a aac_adtstoasc "${outputLocation}"`;

    const tempTextarea = $("<textarea>");
    $("body").append(tempTextarea);
    tempTextarea.val(ffmpegCommand).select();
    document.execCommand("copy");
    tempTextarea.remove();
    closePopup();
  });

  $(document).on("click", ".vjs-fullscreen-control", function() {
    $(this).blur();
  });

  function closePopup() {
    $("#popupContainer").css("display", "none");
  }

  function loadVideo(url) {
    $("#video").html("<source src='" + url + "' type='application/x-mpegURL'>");
    const ply = videojs("video");
    ply.play();
    $("#video").css("display", "block");
  }

  function updateURLParams(url) {
    const newParams = new URLSearchParams();
    newParams.set("m3u8", url);
    window.location.hash = newParams.toString();
  }

  function updateFFmpegCommandOutput() {
    const url = $("#url").val();
    const filename = $("#filename").val();
    const location = $("#location").val();
    const outputFilename = filename ? filename + ".mp4" : "output.mp4";
    const outputLocation = location ? location + "/" + outputFilename : outputFilename;
    const ffmpegCommand = `ffmpeg -i "${url}" -c copy -bsf:a aac_adtstoasc "${outputLocation}"`;
    $("#ffmpegCommandOutput").text(ffmpegCommand);
  }

  $("#url").select();
  $("#url").on("click", function() {
    $(this).select();
  });

  $("#btn-play.disabled").attr("title", "Reload to load a new video!");
  $("#btn-play.disabled").hover(function() {
    $(this).css("cursor", "not-allowed");
  });

});
</script>
</body>
</html>